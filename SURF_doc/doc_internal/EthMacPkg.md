# Package: EthMacPkg

## Constants

| Name                      | Type                | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Description                                                                                         |
| ------------------------- | ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| MAC_ADDR_INIT_C           | slv(47 downto 0)    |  x"000000560008"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                     |
| ARP_TYPE_C                | slv(15 downto 0)    |  x"0608"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | EtherType = ARP = 0x0806                                                                            |
| IPV4_TYPE_C               | slv(15 downto 0)    |  x"0008"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | EtherType = IPV4 = 0x0800                                                                           |
| VLAN_TYPE_C               | slv(15 downto 0)    |  x"0081"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | EtherType = VLAN = 0x8100                                                                           |
| UDP_C                     | slv(7 downto 0)     |  x"11"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Protocol = UDP  = 0x11                                                                              |
| TCP_C                     | slv(7 downto 0)     |  x"06"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Protocol = TCP  = 0x06                                                                              |
| ICMP_C                    | slv(7 downto 0)     |  x"01"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Protocol = ICMP = 0x01                                                                              |
| DHCP_CPORT                | slv(15 downto 0)    |  x"4400"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Port = 68 = 0x0044                                                                                  |
| DHCP_SPORT                | slv(15 downto 0)    |  x"4300"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Port = 67 = 0x0043                                                                                  |
| EMAC_FRAG_BIT_C           | integer             |  0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | First TUSER Bits                                                                                    |
| EMAC_SOF_BIT_C            | integer             |  1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                     |
| EMAC_EOFE_BIT_C           | integer             |  0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Last TUSER Bits                                                                                     |
| EMAC_IPERR_BIT_C          | integer             |  1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                     |
| EMAC_TCPERR_BIT_C         | integer             |  2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                     |
| EMAC_UDPERR_BIT_C         | integer             |  3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                     |
| EMAC_AXIS_CONFIG_C        | AxiStreamConfigType |  (       -- TDEST_INTERLEAVE_C => false,<br><span style="padding-left:20px">       TSTRB_EN_C    => false,<br><span style="padding-left:20px">       TDATA_BYTES_C => 16,<br><span style="padding-left:20px">       TDEST_BITS_C  => 8,<br><span style="padding-left:20px">       TID_BITS_C    => 0,<br><span style="padding-left:20px">       TKEEP_MODE_C  => TKEEP_COMP_C,<br><span style="padding-left:20px">       TUSER_BITS_C  => 4,<br><span style="padding-left:20px">       TUSER_MODE_C  => TUSER_FIRST_LAST_C)                                                                                                                                                                                                                               | Ethernet AXI Stream Configuration                                                                   |
| INT_EMAC_AXIS_CONFIG_C    | AxiStreamConfigType |  (       -- TDEST_INTERLEAVE_C => EMAC_AXIS_CONFIG_C.TDEST_INTERLEAVE_C,<br><span style="padding-left:20px">       TSTRB_EN_C    => EMAC_AXIS_CONFIG_C.TSTRB_EN_C,<br><span style="padding-left:20px">       TDATA_BYTES_C => EMAC_AXIS_CONFIG_C.TDATA_BYTES_C,<br><span style="padding-left:20px">       TDEST_BITS_C  => 0,<br><span style="padding-left:20px"> -- TDEST not used internally of EthMacTop.vhd       TID_BITS_C    => EMAC_AXIS_CONFIG_C.TID_BITS_C,<br><span style="padding-left:20px">       TKEEP_MODE_C  => EMAC_AXIS_CONFIG_C.TKEEP_MODE_C,<br><span style="padding-left:20px">       TUSER_BITS_C  => EMAC_AXIS_CONFIG_C.TUSER_BITS_C,<br><span style="padding-left:20px">       TUSER_MODE_C  => EMAC_AXIS_CONFIG_C.TUSER_MODE_C) | Ethernet AXI Stream Configuration that's optimized for 141-bit FIFO interface (2 x 72b input BRAMs) |
| ETH_MAC_CONFIG_INIT_C     | EthMacConfigType    |  (       macAddress  => MAC_ADDR_INIT_C,<br><span style="padding-left:20px">       filtEnable  => '1',<br><span style="padding-left:20px">       pauseEnable => '1',<br><span style="padding-left:20px">       pauseTime   => x"00FF",<br><span style="padding-left:20px">       pauseThresh => toSlv((9000/16),<br><span style="padding-left:20px"> 16),<br><span style="padding-left:20px">  -- 9000B jumbo frame in cache       ipCsumEn    => '1',<br><span style="padding-left:20px">       tcpCsumEn   => '1',<br><span style="padding-left:20px">       udpCsumEn   => '1',<br><span style="padding-left:20px">       dropOnPause => '0')                                                                                                          |                                                                                                     |
| ETH_MAC_STATUS_INIT_C     | EthMacStatusType    |  (       rxFifoDropCnt => '0',<br><span style="padding-left:20px">       rxPauseCnt    => '0',<br><span style="padding-left:20px">       txPauseCnt    => '0',<br><span style="padding-left:20px">       rxCountEn     => '0',<br><span style="padding-left:20px">       rxOverFlow    => '0',<br><span style="padding-left:20px">       rxCrcErrorCnt => '0',<br><span style="padding-left:20px">       txCountEn     => '0',<br><span style="padding-left:20px">       txUnderRunCnt => '0',<br><span style="padding-left:20px">       txNotReadyCnt => '0')                                                                                                                                                                                            |                                                                                                     |
| EMAC_CSUM_PIPELINE_C      | natural             |  3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                     |
| ETH_MAC_CSUM_ACCUM_INIT_C | EthMacCsumAccumType |  (       step => (others => '0'),<br><span style="padding-left:20px">       sum1 => (others => (others => '0')),<br><span style="padding-left:20px">       sum3 => (others => '0'),<br><span style="padding-left:20px">       sum5 => (others => '0'))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                     |
## Types

| Name                 | Type                                            | Description                |
| -------------------- | ----------------------------------------------- | -------------------------- |
| EthMacConfigType     |                                                 | Generic XMAC Configuration |
| EthMacConfigArray    | array (natural range<>) of EthMacConfigType     |                            |
| EthMacStatusType     |                                                 | Generic XMAC Status        |
| EthMacStatusArray    | array (natural range<>) of EthMacStatusType     |                            |
| EthMacCsumAccumType  |                                                 |                            |
| EthMacCsumAccumArray | array (natural range<>) of EthMacCsumAccumType  |                            |
## Functions
- EthPortArrayBigEndian <font id="function_arguments">(portNum : PositiveArray;<br><span style="padding-left:20px"> portSize : positive) </font> <font id="function_return">return Slv16Array </font>
- GetEthMacCsum <font id="function_arguments">( udpDet  : in    sl;<br><span style="padding-left:20px"> last    : in    sl;<br><span style="padding-left:20px"> hdr     : in    Slv8Array(19 downto 0);<br><span style="padding-left:20px">  -- IPv4 Header tKeep   : in    slv(15 downto 0);<br><span style="padding-left:20px">        -- TCP/Data tKeep tData   : in    slv(127 downto 0);<br><span style="padding-left:20px">       -- TCP/Data tKeep len     : in    slv(15 downto 0);<br><span style="padding-left:20px"> ibcsum  : in    slv(15 downto 0);<br><span style="padding-left:20px">        -- TCP/UDP checksum to compare r       : in    EthMacCsumAccumArray(1 downto 0);<br><span style="padding-left:20px"> v       : inout EthMacCsumAccumArray(1 downto 0);<br><span style="padding-left:20px"> ipValid : inout sl;<br><span style="padding-left:20px"> ipCsum  : inout slv(15 downto 0);<br><span style="padding-left:20px"> valid   : inout sl;<br><span style="padding-left:20px"> csum    : inout slv(15 downto 0)) </font> <font id="function_return">return ()</font>
