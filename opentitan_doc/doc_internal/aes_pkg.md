# Package: aes_pkg

- **File**: aes_pkg.sv
## Description

Copyright lowRISC contributors.
 Licensed under the Apache License, Version 2.0, see LICENSE for details.
 SPDX-License-Identifier: Apache-2.0
 AES package
 

## Constants

| Name                    | Type                   | Value                                         | Description                                                                                                                                                                   |
| ----------------------- | ---------------------- | --------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| NumSharesKey            | int unsigned           | 2                                             |                                                                                                                                                                               |
| SliceSizeCtr            | int unsigned           | 16                                            | Software updates IV in chunks of 32 bits, the counter updates 16 bits at a time.                                                                                              |
| NumSlicesCtr            | int unsigned           | aes_reg_pkg::NumRegsIv * 32 / SliceSizeCtr    |                                                                                                                                                                               |
| WidthPRDClearing        | int unsigned           | 64                                            | Widths of signals carrying pseudo-random data for clearing                                                                                                                    |
| NumChunksPRDClearing128 | int unsigned           | 128/WidthPRDClearing                          |                                                                                                                                                                               |
| NumChunksPRDClearing256 | int unsigned           | 256/WidthPRDClearing                          |                                                                                                                                                                               |
| WidthPRDSBox            | int unsigned           | 8                                             | Number PRD bits per S-Box. This includes the                                                                                                                                  |
| WidthPRDData            | int unsigned           | 16*WidthPRDSBox                               | 16 S-Boxes for the data path                                                                                                                                                  |
| WidthPRDKey             | int unsigned           | 4*WidthPRDSBox                                | 4 S-Boxes for the key expand                                                                                                                                                  |
| WidthPRDMasking         | int unsigned           | WidthPRDData + WidthPRDKey                    |                                                                                                                                                                               |
| ChunkSizePRDMasking     | int unsigned           | WidthPRDMasking/5                             |                                                                                                                                                                               |
| ClearingLfsrWidth       | int                    | 64                                            | Clearing PRNG default LFSR seed and permutation These LFSR parameters have been generated with $ util/design/gen-lfsr-seed.py --width 64 --seed 31468618 --prefix "Clearing"  |
| clearing_lfsr_seed_t    | clearing_lfsr_seed_t   | 64'hc32d580f74f1713a                          |                                                                                                                                                                               |
| clearing_lfsr_perm_t    | clearing_lfsr_perm_t   |                                               |                                                                                                                                                                               |
| clearing_lfsr_perm_t    | clearing_lfsr_perm_t   |                                               | A second permutation is needed for the second share.                                                                                                                          |
| MaskingLfsrWidth        | int                    | 160                                           | = WidthPRDMasking = WidthPRDSBox * (16 + 4)                                                                                                                                   |
| masking_lfsr_seed_t     | masking_lfsr_seed_t    | 160'hc132b5723c5a4cf4743b3c7c32d580f74f1713a  |                                                                                                                                                                               |
| MskgChunkLfsrWidth      | int                    | 32                                            | = ChunkSizePRDMasking = WidthPRDMasking/5                                                                                                                                     |
| mskg_chunk_lfsr_perm_t  | mskg_chunk_lfsr_perm_t | 160'heb3749dc187e7434d7f62a3d251e1c5b8cd10491 |                                                                                                                                                                               |
| AES_MODE_WIDTH          | int                    | 6                                             | Parameters used for controlgroups in the coverage                                                                                                                             |
| AES_KEYLEN_WIDTH        | int                    | 3                                             |                                                                                                                                                                               |
| Mux2SelWidth            | int                    | 3                                             |                                                                                                                                                                               |
| Mux3SelWidth            | int                    | 5                                             |                                                                                                                                                                               |
| Mux4SelWidth            | int                    | 5                                             |                                                                                                                                                                               |
| Mux6SelWidth            | int                    | 6                                             |                                                                                                                                                                               |
| DIPSelNum               | int                    | 2                                             | Mux selector signal types. These use the generic types defined above.                                                                                                         |
| DIPSelWidth             | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
| SISelNum                | int                    | 2                                             |                                                                                                                                                                               |
| SISelWidth              | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
| AddSISelNum             | int                    | 2                                             |                                                                                                                                                                               |
| AddSISelWidth           | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
| StateSelNum             | int                    | 3                                             |                                                                                                                                                                               |
| StateSelWidth           | int                    | Mux3SelWidth                                  |                                                                                                                                                                               |
| AddRKSelNum             | int                    | 3                                             |                                                                                                                                                                               |
| AddRKSelWidth           | int                    | Mux3SelWidth                                  |                                                                                                                                                                               |
| KeyInitSelNum           | int                    | 2                                             |                                                                                                                                                                               |
| KeyInitSelWidth         | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
| IVSelNum                | int                    | 6                                             |                                                                                                                                                                               |
| IVSelWidth              | int                    | Mux6SelWidth                                  |                                                                                                                                                                               |
| KeyFullSelNum           | int                    | 4                                             |                                                                                                                                                                               |
| KeyFullSelWidth         | int                    | Mux4SelWidth                                  |                                                                                                                                                                               |
| KeyDecSelNum            | int                    | 2                                             |                                                                                                                                                                               |
| KeyDecSelWidth          | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
| KeyWordsSelNum          | int                    | 4                                             |                                                                                                                                                                               |
| KeyWordsSelWidth        | int                    | Mux4SelWidth                                  |                                                                                                                                                                               |
| RoundKeySelNum          | int                    | 2                                             |                                                                                                                                                                               |
| RoundKeySelWidth        | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
| AddSOSelNum             | int                    | 3                                             |                                                                                                                                                                               |
| AddSOSelWidth           | int                    | Mux3SelWidth                                  |                                                                                                                                                                               |
| Sp2VNum                 | int                    | 2                                             | Sparse two-value signal type sp2v_e                                                                                                                                           |
| Sp2VWidth               | int                    | Mux2SelWidth                                  |                                                                                                                                                                               |
## Types

| Name                   | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Description            |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------- |
| clearing_lfsr_seed_t   | logic [ClearingLfsrWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                        |
| clearing_lfsr_perm_t   | logic [ClearingLfsrWidth-1:0][$clog2(ClearingLfsrWidth)-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                        |
| masking_lfsr_seed_t    | logic [MaskingLfsrWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                        |
| mskg_chunk_lfsr_perm_t | logic [MskgChunkLfsrWidth-1:0][$clog2(MskgChunkLfsrWidth)-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                        |
| sbox_impl_e            | enum integer {<br><span style="padding-left:20px">   SBoxImplLut,<br><span style="padding-left:20px">                      SBoxImplCanright,<br><span style="padding-left:20px">                 SBoxImplCanrightMasked,<br><span style="padding-left:20px">                                             SBoxImplCanrightMaskedNoreuse,<br><span style="padding-left:20px">                                      SBoxImplDom                                                       }                                                                                                       |                        |
| aes_op_e               | enum logic {<br><span style="padding-left:20px">   AES_ENC = 1'b0,<br><span style="padding-left:20px">   AES_DEC = 1'b1 }                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                        |
| aes_mode_e             | enum logic [AES_MODE_WIDTH-1:0] {<br><span style="padding-left:20px">   AES_ECB  = 6'b00_0001,<br><span style="padding-left:20px">   AES_CBC  = 6'b00_0010,<br><span style="padding-left:20px">   AES_CFB  = 6'b00_0100,<br><span style="padding-left:20px">   AES_OFB  = 6'b00_1000,<br><span style="padding-left:20px">   AES_CTR  = 6'b01_0000,<br><span style="padding-left:20px">   AES_NONE = 6'b10_0000 }                                                                                                                                                                           |                        |
| ciph_op_e              | enum logic {<br><span style="padding-left:20px">   CIPH_FWD = 1'b0,<br><span style="padding-left:20px">   CIPH_INV = 1'b1 }                                                                                                                                                                                                                                                                                                                                                                                                                                                                |                        |
| key_len_e              | enum logic [AES_KEYLEN_WIDTH-1:0] {<br><span style="padding-left:20px">   AES_128 = 3'b001,<br><span style="padding-left:20px">   AES_192 = 3'b010,<br><span style="padding-left:20px">   AES_256 = 3'b100 }                                                                                                                                                                                                                                                                                                                                                                               |                        |
| status_t               | struct packed {<br><span style="padding-left:20px">   logic [31:7] unused;<br><span style="padding-left:20px">   logic        alert_fatal_fault;<br><span style="padding-left:20px">   logic        alert_recov_ctrl_update_err;<br><span style="padding-left:20px">   logic        input_ready;<br><span style="padding-left:20px">   logic        output_valid;<br><span style="padding-left:20px">   logic        output_lost;<br><span style="padding-left:20px">   logic        stall;<br><span style="padding-left:20px">   logic        idle;<br><span style="padding-left:20px"> } |                        |
| alert_test_t           | struct packed {<br><span style="padding-left:20px">   logic        recov_ctrl_update_err;<br><span style="padding-left:20px">   logic        fatal_fault;<br><span style="padding-left:20px"> }                                                                                                                                                                                                                                                                                                                                                                                            |                        |
| mux2_sel_e             | enum logic [Mux2SelWidth-1:0] {<br><span style="padding-left:20px">   MUX2_SEL_0 = 3'b011,<br><span style="padding-left:20px">   MUX2_SEL_1 = 3'b100 }                                                                                                                                                                                                                                                                                                                                                                                                                                     |                        |
| mux3_sel_e             | enum logic [Mux3SelWidth-1:0] {<br><span style="padding-left:20px">   MUX3_SEL_0 = 5'b01110,<br><span style="padding-left:20px">   MUX3_SEL_1 = 5'b11000,<br><span style="padding-left:20px">   MUX3_SEL_2 = 5'b00001 }                                                                                                                                                                                                                                                                                                                                                                    |                        |
| mux4_sel_e             | enum logic [Mux4SelWidth-1:0] {<br><span style="padding-left:20px">   MUX4_SEL_0 = 5'b01110,<br><span style="padding-left:20px">   MUX4_SEL_1 = 5'b11000,<br><span style="padding-left:20px">   MUX4_SEL_2 = 5'b00001,<br><span style="padding-left:20px">   MUX4_SEL_3 = 5'b10111 }                                                                                                                                                                                                                                                                                                       |                        |
| mux6_sel_e             | enum logic [Mux6SelWidth-1:0] {<br><span style="padding-left:20px">   MUX6_SEL_0 = 6'b011101,<br><span style="padding-left:20px">   MUX6_SEL_1 = 6'b110000,<br><span style="padding-left:20px">   MUX6_SEL_2 = 6'b001000,<br><span style="padding-left:20px">   MUX6_SEL_3 = 6'b000011,<br><span style="padding-left:20px">   MUX6_SEL_4 = 6'b111110,<br><span style="padding-left:20px">   MUX6_SEL_5 = 6'b100101 }                                                                                                                                                                       |                        |
| dip_sel_e              | enum logic [DIPSelWidth-1:0] {<br><span style="padding-left:20px">   DIP_DATA_IN = MUX2_SEL_0,<br><span style="padding-left:20px">   DIP_CLEAR   = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                                            |                        |
| si_sel_e               | enum logic [SISelWidth-1:0] {<br><span style="padding-left:20px">   SI_ZERO = MUX2_SEL_0,<br><span style="padding-left:20px">   SI_DATA = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                                                     |                        |
| add_si_sel_e           | enum logic [AddSISelWidth-1:0] {<br><span style="padding-left:20px">   ADD_SI_ZERO = MUX2_SEL_0,<br><span style="padding-left:20px">   ADD_SI_IV   = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                                          |                        |
| state_sel_e            | enum logic [StateSelWidth-1:0] {<br><span style="padding-left:20px">   STATE_INIT  = MUX3_SEL_0,<br><span style="padding-left:20px">   STATE_ROUND = MUX3_SEL_1,<br><span style="padding-left:20px">   STATE_CLEAR = MUX3_SEL_2 }                                                                                                                                                                                                                                                                                                                                                          |                        |
| add_rk_sel_e           | enum logic [AddRKSelWidth-1:0] {<br><span style="padding-left:20px">   ADD_RK_INIT  = MUX3_SEL_0,<br><span style="padding-left:20px">   ADD_RK_ROUND = MUX3_SEL_1,<br><span style="padding-left:20px">   ADD_RK_FINAL = MUX3_SEL_2 }                                                                                                                                                                                                                                                                                                                                                       |                        |
| key_init_sel_e         | enum logic [KeyInitSelWidth-1:0] {<br><span style="padding-left:20px">   KEY_INIT_INPUT = MUX2_SEL_0,<br><span style="padding-left:20px">   KEY_INIT_CLEAR = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                                  |                        |
| iv_sel_e               | enum logic [IVSelWidth-1:0] {<br><span style="padding-left:20px">   IV_INPUT        = MUX6_SEL_0,<br><span style="padding-left:20px">   IV_DATA_OUT     = MUX6_SEL_1,<br><span style="padding-left:20px">   IV_DATA_OUT_RAW = MUX6_SEL_2,<br><span style="padding-left:20px">   IV_DATA_IN_PREV = MUX6_SEL_3,<br><span style="padding-left:20px">   IV_CTR          = MUX6_SEL_4,<br><span style="padding-left:20px">   IV_CLEAR        = MUX6_SEL_5 }                                                                                                                                     |                        |
| key_full_sel_e         | enum logic [KeyFullSelWidth-1:0] {<br><span style="padding-left:20px">   KEY_FULL_ENC_INIT = MUX4_SEL_0,<br><span style="padding-left:20px">   KEY_FULL_DEC_INIT = MUX4_SEL_1,<br><span style="padding-left:20px">   KEY_FULL_ROUND    = MUX4_SEL_2,<br><span style="padding-left:20px">   KEY_FULL_CLEAR    = MUX4_SEL_3 }                                                                                                                                                                                                                                                                |                        |
| key_dec_sel_e          | enum logic [KeyDecSelWidth-1:0] {<br><span style="padding-left:20px">   KEY_DEC_EXPAND = MUX2_SEL_0,<br><span style="padding-left:20px">   KEY_DEC_CLEAR  = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                                   |                        |
| key_words_sel_e        | enum logic [KeyWordsSelWidth-1:0] {<br><span style="padding-left:20px">   KEY_WORDS_0123 = MUX4_SEL_0,<br><span style="padding-left:20px">   KEY_WORDS_2345 = MUX4_SEL_1,<br><span style="padding-left:20px">   KEY_WORDS_4567 = MUX4_SEL_2,<br><span style="padding-left:20px">   KEY_WORDS_ZERO = MUX4_SEL_3 }                                                                                                                                                                                                                                                                           |                        |
| round_key_sel_e        | enum logic [RoundKeySelWidth-1:0] {<br><span style="padding-left:20px">   ROUND_KEY_DIRECT = MUX2_SEL_0,<br><span style="padding-left:20px">   ROUND_KEY_MIXED  = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                             |                        |
| add_so_sel_e           | enum logic [AddSOSelWidth-1:0] {<br><span style="padding-left:20px">   ADD_SO_ZERO = MUX3_SEL_0,<br><span style="padding-left:20px">   ADD_SO_IV   = MUX3_SEL_1,<br><span style="padding-left:20px">   ADD_SO_DIP  = MUX3_SEL_2 }                                                                                                                                                                                                                                                                                                                                                          |                        |
| sp2v_e                 | enum logic [Sp2VWidth-1:0] {<br><span style="padding-left:20px">   SP2V_HIGH = MUX2_SEL_0,<br><span style="padding-left:20px">   SP2V_LOW  = MUX2_SEL_1 }                                                                                                                                                                                                                                                                                                                                                                                                                                  |                        |
| ctrl_reg_t             | struct packed {<br><span style="padding-left:20px">   logic      force_zero_masks;<br><span style="padding-left:20px">   logic      manual_operation;<br><span style="padding-left:20px">   key_len_e  key_len;<br><span style="padding-left:20px">   aes_mode_e mode;<br><span style="padding-left:20px">   aes_op_e   operation;<br><span style="padding-left:20px"> }                                                                                                                                                                                                                   | Control register type  |
## Functions
- aes_mul2 <font id="function_arguments">(logic [7:0])</font> <font id="function_return">return (logic [7:0])</font>
**Description**
Multiplication by {02} (i.e. x) on GF(2^8)
with field generating polynomial {01}{1b} (9'h11b)
Sometimes also denoted by xtime().

- aes_mul4 <font id="function_arguments">(logic [7:0])</font> <font id="function_return">return (logic [7:0])</font>
**Description**
Multiplication by {04} (i.e. x^2) on GF(2^8)
with field generating polynomial {01}{1b} (9'h11b)

- aes_div2 <font id="function_arguments">(logic [7:0])</font> <font id="function_return">return (logic [7:0])</font>
**Description**
Division by {02} (i.e. x) on GF(2^8)
with field generating polynomial {01}{1b} (9'h11b)
This is the inverse of aes_mul2() or xtime().

- aes_circ_byte_shift <font id="function_arguments">(logic [31:0] in,<br><span style="padding-left:20px"> logic [1:0])</font> <font id="function_return">return (logic [31:0])</font>
**Description**
Circular byte shift to the left

- aes_transpose <font id="function_arguments">(logic [3:0][3:0][7:0])</font> <font id="function_return">return (logic [3:0][3:0][7:0])</font>
**Description**
Transpose state matrix

- aes_col_get <font id="function_arguments">(logic [3:0][3:0][7:0] in,<br><span style="padding-left:20px"> logic [1:0])</font> <font id="function_return">return (logic [3:0][7:0])</font>
**Description**
Extract single column from state matrix

- aes_mvm <font id="function_arguments">(logic [7:0] vec_b,<br><span style="padding-left:20px">)</font> <font id="function_return">return (logic [7:0])</font>
**Description**
Matrix-vector multiplication in GF(2^8): c = A * b

- aes_prd_get_lsbs <font id="function_arguments">(logic [(4*WidthPRDSBox)-1:0])</font> <font id="function_return">return (logic [3:0][7:0])</font>
**Description**
When using a masked S-Box implementation other than Canright, we still select the 8 LSBs of
the per-S-Box PRD to form the input data mask of the corresponding byte. We do this to
distribute the input data masks over all LFSR chunks of the masking PRNG.
For one row of the state matrix, extract the 8 LSBs of the per-S-Box PRD from the PRNG output.
These bits are used as:
- input data masks, and
- SubBytes output mask when using a masked Canright S-Box implementation.

