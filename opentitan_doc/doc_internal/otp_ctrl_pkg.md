# Package: otp_ctrl_pkg

- **File**: otp_ctrl_pkg.sv
## Description

 Copyright lowRISC contributors.
 Licensed under the Apache License, Version 2.0, see LICENSE for details.
 SPDX-License-Identifier: Apache-2.0



## Signals

| Name         | Type       | Description |
| ------------ | ---------- | ----------- |
| otp_ctrl_pkg | endpackage |             |
## Constants

| Name                   | Type                | Value                                                             | Description                                                                                                                                                              |
| ---------------------- | ------------------- | ----------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| OtpTestCtrlWidth       | int                 | 32                                                                | //////////////////////  General Parameters // //////////////////////  Number of vendor-specific test CSR bits coming from and going to  the life cycle TAP registers.    |
| OtpTestStatusWidth     | int                 | 32                                                                |                                                                                                                                                                          |
| OtpTestVectWidth       | int                 | 8                                                                 |                                                                                                                                                                          |
| EdnDataWidth           | int                 | 64                                                                |  Width of entropy input                                                                                                                                                  |
| NumPartWidth           | int                 | vbits(NumPart)                                                    |                                                                                                                                                                          |
| SwWindowAddrWidth      | int                 | vbits(NumSwCfgWindowWords)                                        |                                                                                                                                                                          |
| LfsrWidth              | int                 | 40                                                                |  Background check timer LFSR width.                                                                                                                                      |
| LfsrUsageThreshold     | int                 | 16                                                                |  The LFSR will be reseeded once LfsrUsageThreshold  values have been drawn from it.                                                                                      |
| DaiCmdWidth            | int                 | 3                                                                 |                                                                                                                                                                          |
| OtpEnWidth             | int                 | 8                                                                 |  Width of HW CFG Enable Fields                                                                                                                                           |
| DeviceIdWidth          | int                 | 256                                                               |                                                                                                                                                                          |
| ManufStateWidth        | int                 | 256                                                               |                                                                                                                                                                          |
| OtpWidth               | int                 | 16                                                                | ////////////////////////////////////  Typedefs for OTP Macro Interface // ////////////////////////////////////  OTP-macro specific                                       |
| OtpAddrWidth           | int                 | OtpByteAddrWidth - $clog2(OtpWidth/8)                             |                                                                                                                                                                          |
| OtpDepth               | int                 | 2**OtpAddrWidth                                                   |                                                                                                                                                                          |
| OtpSizeWidth           | int                 | 2                                                                 |  Allows to transfer up to 4 native OTP words at once.                                                                                                                    |
| OtpErrWidth            | int                 | 3                                                                 |                                                                                                                                                                          |
| OtpPwrSeqWidth         | int                 | 2                                                                 |                                                                                                                                                                          |
| OtpIfWidth             | int                 | 2**OtpSizeWidth*OtpWidth                                          |                                                                                                                                                                          |
| OtpAddrShift           | int                 | OtpByteAddrWidth - OtpAddrWidth                                   |  Number of Byte address bits to cut off in order to get the native OTP word address.                                                                                     |
| ScrmblKeyWidth         | int                 | 128                                                               | ///////////////////////////////  Typedefs for OTP Scrambling // ///////////////////////////////                                                                          |
| ScrmblBlockWidth       | int                 | 64                                                                |                                                                                                                                                                          |
| NumPresentRounds       | int                 | 31                                                                |                                                                                                                                                                          |
| ScrmblBlockHalfWords   | int                 | ScrmblBlockWidth / OtpWidth                                       |                                                                                                                                                                          |
| otp_lc_data_t          | otp_lc_data_t       | undefined                                                         |  Default for dangling connection.  Note that we put the life cycle into  TEST_UNLOCKED0 by default such that top levels without  the OTP controller can still function.  |
| FlashKeySeedWidth      | int                 | 256                                                               | //////////////////////////////  Typedefs for Key Broadcast // //////////////////////////////                                                                             |
| SramKeySeedWidth       | int                 | 128                                                               |                                                                                                                                                                          |
| KeyMgrKeyWidth         | int                 | 256                                                               |                                                                                                                                                                          |
| FlashKeyWidth          | int                 | 128                                                               |                                                                                                                                                                          |
| SramKeyWidth           | int                 | 128                                                               |                                                                                                                                                                          |
| SramNonceWidth         | int                 | 128                                                               |                                                                                                                                                                          |
| OtbnKeyWidth           | int                 | 128                                                               |                                                                                                                                                                          |
| OtbnNonceWidth         | int                 | 64                                                                |                                                                                                                                                                          |
| otp_keymgr_key_t       | otp_keymgr_key_t    | undefined                                                         |                                                                                                                                                                          |
| flash_otp_key_rsp_t    | flash_otp_key_rsp_t | undefined                                                         |  Default for dangling connection                                                                                                                                         |
| sram_otp_key_rsp_t     | sram_otp_key_rsp_t  | undefined                                                         |  Default for dangling connection                                                                                                                                         |
| RndCnstLfsrSeedDefault | lfsr_seed_t         | 40'h453d28ea98                                                    |                                                                                                                                                                          |
| RndCnstLfsrPermDefault | lfsr_perm_t         | 240'h4235171482c225f79289b32181a0163a760355d3447063d16661e44c12a5 |                                                                                                                                                                          |
## Types

| Name                     | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Description                                                                                                                                                                                                                                 |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| access_e                 | enum logic [7:0] {<br><span style="padding-left:20px">     Unlocked = 8'h5A,<br><span style="padding-left:20px">     Locked   = 8'hA5   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |  Redundantly encoded and complementary values are used to for signalling to the partition  controller FSMs and the DAI whether a partition is locked or not. Any other value than  "Unlocked" is interpreted as "Locked" in those FSMs.     |
| part_access_t            | struct packed {<br><span style="padding-left:20px">     access_e read_lock;<br><span style="padding-left:20px">     access_e write_lock;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  Partition access type                                                                                                                                                                                                                      |
| dai_cmd_e                | enum logic [DaiCmdWidth-1:0] {<br><span style="padding-left:20px">     DaiRead   = 3'b001,<br><span style="padding-left:20px">     DaiWrite  = 3'b010,<br><span style="padding-left:20px">     DaiDigest = 3'b100   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                             |
| otp_en_t                 | logic [OtpEnWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                             |
| enable_e                 | enum logic [7:0] {<br><span style="padding-left:20px">     Disabled = 8'h5A,<br><span style="padding-left:20px">     Enabled = 8'hA5   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                             |
| otp_device_id_t          | logic [DeviceIdWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                             |
| otp_manuf_state_t        | logic [ManufStateWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |
| otp_err_e                | enum logic [OtpErrWidth-1:0] {<br><span style="padding-left:20px">     NoError              = 3'h0,<br><span style="padding-left:20px">     MacroError           = 3'h1,<br><span style="padding-left:20px">     MacroEccCorrError    = 3'h2,<br><span style="padding-left:20px">     MacroEccUncorrError  = 3'h3,<br><span style="padding-left:20px">     MacroWriteBlankError = 3'h4,<br><span style="padding-left:20px">     AccessError          = 3'h5,<br><span style="padding-left:20px">     CheckFailError       = 3'h6,<br><span style="padding-left:20px">     FsmStateError        = 3'h7   }                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                             |
| otp_scrmbl_cmd_e         | enum logic [2:0] {<br><span style="padding-left:20px">     Decrypt,<br><span style="padding-left:20px">     Encrypt,<br><span style="padding-left:20px">     LoadShadow,<br><span style="padding-left:20px">     Digest,<br><span style="padding-left:20px">     DigestInit,<br><span style="padding-left:20px">     DigestFinalize   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                             |
| otp_lc_data_t            | struct packed {<br><span style="padding-left:20px">     logic                            valid;<br><span style="padding-left:20px">     logic                            error;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_state_e    state;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_cnt_e      count;<br><span style="padding-left:20px">                    lc_ctrl_pkg::lc_tx_t             secrets_valid;<br><span style="padding-left:20px">               lc_ctrl_pkg::lc_tx_t             test_tokens_valid;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_token_t    test_unlock_token;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_token_t    test_exit_token;<br><span style="padding-left:20px">               lc_ctrl_pkg::lc_tx_t             rma_token_valid;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_token_t    rma_token;<br><span style="padding-left:20px">   } | /////////////////////////////  Typedefs for LC Interface // /////////////////////////////  The tokens below are all hash post-images                                                                                                        |
| lc_otp_program_req_t     | struct packed {<br><span style="padding-left:20px">     logic req;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_state_e state;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_cnt_e   count;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                             |
| lc_otp_program_rsp_t     | struct packed {<br><span style="padding-left:20px">     logic err;<br><span style="padding-left:20px">     logic ack;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                                                                                                                                                                                                                             |
| lc_otp_token_req_t       | struct packed {<br><span style="padding-left:20px">     logic req;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_token_t token_input;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |  RAW unlock token hashing request.                                                                                                                                                                                                          |
| lc_otp_token_rsp_t       | struct packed {<br><span style="padding-left:20px">     logic ack;<br><span style="padding-left:20px">     lc_ctrl_state_pkg::lc_token_t hashed_token;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                             |
| lc_otp_vendor_test_req_t | struct packed {<br><span style="padding-left:20px">     logic [OtpTestCtrlWidth-1:0] ctrl;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                             |
| lc_otp_vendor_test_rsp_t | struct packed {<br><span style="padding-left:20px">     logic [OtpTestStatusWidth-1:0] status;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                             |
| sram_key_t               | logic [SramKeyWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                             |
| sram_nonce_t             | logic [SramNonceWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                             |
| otbn_key_t               | logic [OtbnKeyWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                             |
| otbn_nonce_t             | logic [OtbnNonceWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                             |
| otp_keymgr_key_t         | struct packed {<br><span style="padding-left:20px">     logic valid;<br><span style="padding-left:20px">     logic [KeyMgrKeyWidth-1:0] key_share0;<br><span style="padding-left:20px">     logic [KeyMgrKeyWidth-1:0] key_share1;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                             |
| flash_otp_key_req_t      | struct packed {<br><span style="padding-left:20px">     logic data_req;<br><span style="padding-left:20px">      logic addr_req;<br><span style="padding-left:20px">    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                             |
| sram_otp_key_req_t       | struct packed {<br><span style="padding-left:20px">     logic req;<br><span style="padding-left:20px">    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |
| otbn_otp_key_req_t       | struct packed {<br><span style="padding-left:20px">     logic req;<br><span style="padding-left:20px">    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |
| flash_otp_key_rsp_t      | struct packed {<br><span style="padding-left:20px">     logic data_ack;<br><span style="padding-left:20px">                         logic addr_ack;<br><span style="padding-left:20px">                         logic [FlashKeyWidth-1:0] key;<br><span style="padding-left:20px">          logic [FlashKeyWidth-1:0] rand_key;<br><span style="padding-left:20px">     logic seed_valid;<br><span style="padding-left:20px">                                                             }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |
| sram_otp_key_rsp_t       | struct packed {<br><span style="padding-left:20px">     logic        ack;<br><span style="padding-left:20px">             sram_key_t   key;<br><span style="padding-left:20px">             sram_nonce_t nonce;<br><span style="padding-left:20px">           logic        seed_valid;<br><span style="padding-left:20px">    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                             |
| otbn_otp_key_rsp_t       | struct packed {<br><span style="padding-left:20px">     logic        ack;<br><span style="padding-left:20px">             otbn_key_t   key;<br><span style="padding-left:20px">             otbn_nonce_t nonce;<br><span style="padding-left:20px">           logic        seed_valid;<br><span style="padding-left:20px">    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                             |
| pwr_otp_init_req_t       | struct packed {<br><span style="padding-left:20px">     logic init;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | //////////////////////////////  Power/Reset Ctrl Interface // //////////////////////////////                                                                                                                                                |
| pwr_otp_init_rsp_t       | struct packed {<br><span style="padding-left:20px">     logic done;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |
| otp_pwr_state_t          | struct packed {<br><span style="padding-left:20px">     logic idle;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                             |
| otp_ast_req_t            | struct packed {<br><span style="padding-left:20px">     logic [OtpPwrSeqWidth-1:0] pwr_seq;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | /////////////////  AST Interface // /////////////////                                                                                                                                                                                       |
| otp_ast_rsp_t            | struct packed {<br><span style="padding-left:20px">     logic [OtpPwrSeqWidth-1:0] pwr_seq_h;<br><span style="padding-left:20px">   }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                             |
| lfsr_seed_t              | logic [LfsrWidth-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | /////////////////////////////////////////  Defaults for random netlist constants // /////////////////////////////////////////  These LFSR parameters have been generated with  $ util/design/gen-lfsr-seed.py --width 40 --seed 4247488366  |
| lfsr_perm_t              | logic [LfsrWidth-1:0][$clog2(LfsrWidth)-1:0]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                             |
