
<style>
  table {
    width:70%;
    margin-left: auto;
    margin-right: auto
  }
  svg {
    display:block;  
    width:60%;
    margin-left: auto;
    margin-right: auto
  }
  h1, h2, h3 {
    margin-left:1.5%;
    width:98%;
    font-weight:bold
  }
  code {
    color:#545253;
  }
  p {
    width: 98%;
    color:black;
    margin-top:5px;
    margin-bottom:5px 
  }
  * {
    color:black;
    line-height: 1.6;
  }
  li{
    margin: 20px 0;
  }
  #function_return{
    font-weight: bold;
    color:green;
  }
  #teroshdl_description, li {
    width: 95%;
    margin-left:2%;
    margin-right:2%;
  }
  #function_arguments{
    color:black;
  }
  #descriptions{
    width: 90%;
    margin-left:5.5%;
    margin-right:3%;
  }
  div.templateTerosHDL {
    background-color: white;
    position:absolute;
  }
  td, th {
    padding:2px; 
    border: 1px solid grey;
  }
  th {
    background-color: #ffd78c;
  }
  tr:hover {
    background-color: #ddd;
  }
  tr:nth-child(even){
    background-color: #f2f2f2;
  }
</style>
<div id="teroshdl" class='templateTerosHDL'>
<a id=rom_ctrl_counter><h1 id="entity-rom_ctrl_counter">Entity: rom_ctrl_counter</h1></a><h2 id="diagram">Diagram</h2><p><svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" viewBox="0 0 681.6666666666667 190"><svg id="SvgjsSvg1002" width="2" height="0" focusable="false" style="overflow:hidden;top:-100%;left:-100%;position:absolute;opacity:0"><polyline id="SvgjsPolyline1003" points="51.66666666666667,0 66.66666666666667,0"></polyline><path id="SvgjsPath1004" d="M0 0 "></path></svg><rect id="SvgjsRect1006" width="360" height="50" fill="black" x="66.66666666666667" y="0"></rect><rect id="SvgjsRect1007" width="356" height="45" fill="#bdecb6" x="68.66666666666667" y="2"></rect><text id="SvgjsText1008" font-family="Helvetica" x="46.66666666666667" y="-5.698437500000001" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1009" dy="26" x="46.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   int </tspan></text><text id="SvgjsText1010" font-family="Helvetica" x="81.66666666666667" y="-5.698437500000001" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1011" dy="26" x="81.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   RomDepth </tspan></text><line id="SvgjsLine1012" x1="51.66666666666667" y1="15" x2="66.66666666666667" y2="15" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1013" font-family="Helvetica" x="46.66666666666667" y="14.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1014" dy="26" x="46.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   int </tspan></text><text id="SvgjsText1015" font-family="Helvetica" x="81.66666666666667" y="14.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1016" dy="26" x="81.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   RomTopCount </tspan></text><line id="SvgjsLine1017" x1="51.66666666666667" y1="35" x2="66.66666666666667" y2="35" stroke-linecap="rec" stroke="black" stroke-width="5"></line><rect id="SvgjsRect1018" width="360" height="130" fill="black" x="66.66666666666667" y="55"></rect><rect id="SvgjsRect1019" width="356" height="125" fill="#fdfd96" x="68.66666666666667" y="57"></rect><text id="SvgjsText1020" font-family="Helvetica" x="46.66666666666667" y="49.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1021" dy="26" x="46.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1022" font-family="Helvetica" x="81.66666666666667" y="49.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1023" dy="26" x="81.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   clk_i </tspan></text><line id="SvgjsLine1024" x1="51.66666666666667" y1="70" x2="66.66666666666667" y2="70" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1025" font-family="Helvetica" x="46.66666666666667" y="69.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1026" dy="26" x="46.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1027" font-family="Helvetica" x="81.66666666666667" y="69.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1028" dy="26" x="81.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   rst_ni </tspan></text><line id="SvgjsLine1029" x1="51.66666666666667" y1="90" x2="66.66666666666667" y2="90" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1030" font-family="Helvetica" x="46.66666666666667" y="89.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1031" dy="26" x="46.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1032" font-family="Helvetica" x="81.66666666666667" y="89.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1033" dy="26" x="81.66666666666667" svgjs:data="{&quot;newLined&quot;:true}">   data_rdy_i </tspan></text><line id="SvgjsLine1034" x1="51.66666666666667" y1="110" x2="66.66666666666667" y2="110" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1035" font-family="Helvetica" x="446.6666666666667" y="49.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1036" dy="26" x="446.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1037" font-family="Helvetica" x="411.6666666666667" y="49.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1038" dy="26" x="411.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   done_o </tspan></text><line id="SvgjsLine1039" x1="426.6666666666667" y1="70" x2="441.6666666666667" y2="70" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1040" font-family="Helvetica" x="446.6666666666667" y="69.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1041" dy="26" x="446.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   [vbits(RomDepth)-1:0] </tspan></text><text id="SvgjsText1042" font-family="Helvetica" x="411.6666666666667" y="69.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1043" dy="26" x="411.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   read_addr_o </tspan></text><line id="SvgjsLine1044" x1="426.6666666666667" y1="90" x2="441.6666666666667" y2="90" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1045" font-family="Helvetica" x="446.6666666666667" y="89.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1046" dy="26" x="446.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1047" font-family="Helvetica" x="411.6666666666667" y="89.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1048" dy="26" x="411.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   read_req_o </tspan></text><line id="SvgjsLine1049" x1="426.6666666666667" y1="110" x2="441.6666666666667" y2="110" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1050" font-family="Helvetica" x="446.6666666666667" y="109.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1051" dy="26" x="446.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   [vbits(RomDepth)-1:0] </tspan></text><text id="SvgjsText1052" font-family="Helvetica" x="411.6666666666667" y="109.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1053" dy="26" x="411.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   data_addr_o </tspan></text><line id="SvgjsLine1054" x1="426.6666666666667" y1="130" x2="441.6666666666667" y2="130" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1055" font-family="Helvetica" x="446.6666666666667" y="129.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1056" dy="26" x="446.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1057" font-family="Helvetica" x="411.6666666666667" y="129.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1058" dy="26" x="411.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   data_vld_o </tspan></text><line id="SvgjsLine1059" x1="426.6666666666667" y1="150" x2="441.6666666666667" y2="150" stroke-linecap="rec" stroke="black" stroke-width="5"></line><text id="SvgjsText1060" font-family="Helvetica" x="446.6666666666667" y="149.3015625" font-size="20" text-anchor="start" family="Helvetica" size="20" anchor="start" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1061" dy="26" x="446.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">    </tspan></text><text id="SvgjsText1062" font-family="Helvetica" x="411.6666666666667" y="149.3015625" font-size="20" text-anchor="end" family="Helvetica" size="20" anchor="end" svgjs:data="{&quot;leading&quot;:&quot;1.3&quot;}"><tspan id="SvgjsTspan1063" dy="26" x="411.6666666666667" svgjs:data="{&quot;newLined&quot;:true}">   data_last_nontop_o </tspan></text><line id="SvgjsLine1064" x1="426.6666666666667" y1="170" x2="441.6666666666667" y2="170" stroke-linecap="rec" stroke="black" stroke-width="5"></line></svg></p><h2 id="description">Description</h2><div id="teroshdl_description"><p>Copyright lowRISC contributors. Licensed under the Apache License, Version 2.0, see LICENSE for details. SPDX-License-Identifier: Apache-2.0 A counter module that drives the ROM accesses from the checker. This module doesn't need state hardening: an attacker that glitches its behaviour can stall the chip or read ROM data in the wrong order. Assuming we've picked a key for the ROM that ensures all words have different values, exploiting a glitch in this module to hide a ROM modification would still need a pre-image attack on SHA-3. RomDepth is the number of words in the ROM. RomTopCount is the number of those words (at the top of the address space) that are considered part of the expected hash. When it comes out of reset, the module starts reading from address zero. Once the reading is done, it will signal done_o. The surrounding (hardened) design should check that done_o never has a high -&gt; low transition. The read_addr_o signal should be connected to the stateful mux that controls access to ROM. This mux gives access to the rom_ctrl_counter until done_o is asserted. The data_addr_o signal gives the address of the ROM word that was just read. The data_* signals are used to handshake with KMAC, although the surrounding FSM will step in once we've got to the top of memory. The counter uses the output buffer on the ROM instance to hold data and drives rom_addr_o and data_vld_o to make a rdy/vld interface with the ROM output. This interface should signal things correctly until done_o goes high. data_last_nontop_o is set on the last word before the top RomTopCount words.</p></div><h2 id="generics">Generics</h2>
<table>
<thead>
<tr>
<th id="generic_name">Generic name</th>
<th id="type">Type</th>
<th id="value">Value</th>
<th id="description">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>RomDepth</td>
<td>int</td>
<td>16</td>
<td></td>
</tr>
<tr>
<td>RomTopCount</td>
<td>int</td>
<td>2</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="ports">Ports</h2>
<table>
<thead>
<tr>
<th id="port_name">Port name</th>
<th id="direction">Direction</th>
<th id="type">Type</th>
<th id="description">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>clk_i</td>
<td>input</td>
<td></td>
<td></td>
</tr>
<tr>
<td>rst_ni</td>
<td>input</td>
<td></td>
<td></td>
</tr>
<tr>
<td>done_o</td>
<td>output</td>
<td></td>
<td></td>
</tr>
<tr>
<td>read_addr_o</td>
<td>output</td>
<td>[vbits(RomDepth)-1:0]</td>
<td></td>
</tr>
<tr>
<td>read_req_o</td>
<td>output</td>
<td></td>
<td></td>
</tr>
<tr>
<td>data_addr_o</td>
<td>output</td>
<td>[vbits(RomDepth)-1:0]</td>
<td></td>
</tr>
<tr>
<td>data_rdy_i</td>
<td>input</td>
<td></td>
<td></td>
</tr>
<tr>
<td>data_vld_o</td>
<td>output</td>
<td></td>
<td></td>
</tr>
<tr>
<td>data_last_nontop_o</td>
<td>output</td>
<td></td>
<td></td>
</tr>
</tbody>
</table><h2 id="signals">Signals</h2>
<table>
<thead>
<tr>
<th id="name">Name</th>
<th id="type">Type</th>
<th id="description">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>go</td>
<td>logic</td>
<td></td>
</tr>
<tr>
<td>req_q</td>
<td>logic</td>
<td></td>
</tr>
<tr>
<td>vld_q</td>
<td>logic</td>
<td></td>
</tr>
<tr>
<td>addr_q</td>
<td>logic [AW-1:0]</td>
<td></td>
</tr>
<tr>
<td>addr_d</td>
<td>logic [AW-1:0]</td>
<td></td>
</tr>
<tr>
<td>done_q</td>
<td>logic</td>
<td></td>
</tr>
<tr>
<td>done_d</td>
<td>logic</td>
<td></td>
</tr>
<tr>
<td>last_nontop_q</td>
<td>logic</td>
<td></td>
</tr>
<tr>
<td>last_nontop_d</td>
<td>logic</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="constants">Constants</h2>
<table>
<thead>
<tr>
<th id="name">Name</th>
<th id="type">Type</th>
<th id="value">Value</th>
<th id="description">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>RomNonTopCount</td>
<td>int</td>
<td>RomDepth - RomTopCount</td>
<td>The number of ROM entries that should be hashed. We assume there are at least 2, so that we can register the data_last_nontop_o signal.</td>
</tr>
<tr>
<td>AW</td>
<td>int</td>
<td>vbits(RomDepth)</td>
<td></td>
</tr>
<tr>
<td>TopAddrInt</td>
<td>int unsigned</td>
<td>RomDepth - 1</td>
<td></td>
</tr>
<tr>
<td>TNTAddrInt</td>
<td>int unsigned</td>
<td>RomNonTopCount - 2</td>
<td></td>
</tr>
<tr>
<td>TopAddr</td>
<td>bit [AW-1:0]</td>
<td>undefined</td>
<td></td>
</tr>
<tr>
<td>TNTAddr</td>
<td>bit [AW-1:0]</td>
<td>undefined</td>
<td></td>
</tr>
</tbody>
</table><h2 id="processes">Processes</h2><ul>
<li>unnamed: ( @(posedge clk_i or negedge rst_ni) )</li>
</ul><ul>
<li>unnamed: ( @(posedge clk_i or negedge rst_ni) )</li>
</ul><br><br><br><br><br><br>